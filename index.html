<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>バス時刻表</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <link rel="apple-touch-icon" href="icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ベースフォントと背景色の調整 */
        body {
            font-family: 'Shippori Mincho', 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: hsl(240, 10%, 97%); /* 非常に薄い青みがかったグレー */
            color: hsl(240, 10%, 20%); /* 落ち着いた濃いグレー */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* 少なくともビューポートの高さ */
            padding: 10px; /* 全体のパディングを少し減らす */
            box-sizing: border-box;
        }

        /* コンテナのスタイル調整 */
        .container {
            background-color: hsl(0, 0%, 100%); /* 純粋な白 */
            border-radius: 18px; /* さらに大きな角丸で優雅に */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07); /* 柔らかく広がるシャドウ */
            max-width: 90%;
            width: 700px;
            height: 98vh; /* ビューポートの高さに合わせて調整、さらに高さを確保 */
            display: flex; /* Flexboxを有効にする */
            flex-direction: column; /* 要素を縦に並べる */
            padding: 20px; /* パディングを調整してスペースを節約 */
            text-align: center;
            border: none;
        }

        /* タイトルの調整 */
        h1 {
            color: hsl(240, 15%, 25%); /* 深いダークグレー/ブルー */
            font-size: 2.1rem; /* さらに小さく */
            font-weight: 700;
            margin-bottom: 12px; /* マージンをさらに減らす */
            letter-spacing: 0.02em; /* わずかに字間を広げる */
        }

        /* 説明文の調整 */
        .instruction-text {
            font-size: 0.85rem; /* さらに小さく */
            color: hsl(240, 5%, 45%); /* 落ち着いたミディアムグレー */
            margin-bottom: 12px; /* マージンをさらに減らす */
            font-weight: 400;
            line-height: 1.4; /* 行の高さを調整 */
        }

        /* セレクターグループの調整 */
        .selector-group {
            margin-bottom: 15px; /* マージンをさらに減らす */
            display: flex;
            flex-direction: column;
            gap: 10px; /* 間隔を調整 */
            align-items: center;
        }

        .schedule-selector, .bus-stop-selector {
            display: flex;
            justify-content: center;
            gap: 6px; /* ボタン間の間隔をさらに調整 */
            width: 100%;
            max-width: 400px; /* さらに狭くする */
            background-color: transparent; 
            box-shadow: none;
            padding: 0;
        }

        /* 平日/土日祝ボタンを横並びにする */
        .schedule-selector {
            flex-direction: row;
        }

        /* バス停選択ボタンは縦並びを維持し、横幅をさらに狭く */
        .bus-stop-selector {
            flex-direction: column;
            max-width: 200px; /* 横幅をさらに狭く */
        }


        /* ラベル（ボタン部分）のスタイル調整 */
        .schedule-selector label, .bus-stop-selector label {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-grow: 1; /* 幅を均等にする */
            flex-basis: 0; /* flex-growが効果を発揮しやすいように */
            font-size: 0.8rem; /* 最小限まで小さく */
            font-weight: 500;
            color: hsl(240, 10%, 35%); /* 落ち着いたグレー */
            cursor: pointer;
            padding: 6px 10px; /* パディングを最小限まで小さく */
            border-radius: 10px; /* 角丸を調整 */
            border: 1px solid hsl(240, 5%, 80%); /* 薄いボーダー */
            background-color: hsl(0, 0%, 100%); /* 白い背景 */
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.015); /* より繊細なシャドウ */
        }

        .schedule-selector label:has(input[type="radio"]:checked),
        .bus-stop-selector label:has(input[type="radio"]:checked) {
            background-color: hsl(210, 80%, 40%); /* 深みのあるブルー */
            border-color: hsl(210, 80%, 40%);
            color: #ffffff;
            box-shadow: 0 2px 6px hsla(210, 80%, 40%, 0.1); /* 強調シャドウ */
        }

        /* ラジオボタン自体の見た目をカスタマイズ */
        .schedule-selector input[type="radio"], .bus-stop-selector input[type="radio"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        /* バスリストの調整 */
        .bus-list {
            display: flex;
            flex-direction: column;
            gap: 10px; /* 間隔を調整 */
            flex-grow: 1; /* 親コンテナの残りのスペースを埋める */
            overflow-y: auto; /* コンテンツが多すぎる場合にのみスクロール */
            padding-right: 8px; /* スクロールバーのスペース */
            margin-bottom: 0; /* 下部マージンをなくす */
        }

        /* 時間グループの調整 */
        .hour-group {
            background-color: hsl(240, 50%, 99.5%); /* ほぼ白の背景 */
            border-radius: 10px; /* 角丸を調整 */
            padding: 15px; /* パディングを調整 */
            margin-bottom: 12px;
            border: 1px solid hsl(240, 5%, 90%); /* 薄いボーダー */
            text-align: left;
            scroll-margin-top: 15px; /* スクロール時のマージン */
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.02); /* 柔らかいシャドウ */
        }

        .hour-title {
            font-size: 1.4rem; /* さらに小さく */
            font-weight: 700;
            color: hsl(240, 15%, 28%); /* 濃いタイトル色 */
            margin-bottom: 8px;
            border-bottom: 1px solid hsl(240, 5%, 92%); /* より細いボーダー */
            padding-bottom: 4px;
        }

        /* バス項目の調整 */
        .bus-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 10px 15px; /* パディングを調整 */
            background-color: hsl(0, 0%, 100%); /* 白い背景 */
            border-radius: 8px; /* 角丸を調整 */
            border: 1px solid hsl(240, 5%, 95%); /* 項目ボーダーをさらに薄く */
            transition: all 0.2s ease-in-out;
            margin-bottom: 6px; /* 間隔を調整 */
            box-shadow: 0 0.5px 2px rgba(0, 0, 0, 0.01); /* 非常に繊細なシャドウ */
        }

        .bus-item.clickable {
            cursor: pointer;
        }

        .bus-item:last-child {
            margin-bottom: 0;
        }

        .bus-item.upcoming {
            background-color: hsl(210, 100%, 96%); /* 明るい青 */
            border-color: hsl(210, 80%, 70%); /* 少し濃い青 */
            box-shadow: 0 3px 10px hsla(210, 80%, 45%, 0.12); /* アクセントカラーのシャドウ */
            transform: translateY(-1px); /* 少し浮き上がる */
            font-weight: 600;
        }

        .bus-item.past {
            opacity: 0.6;
            background-color: hsl(240, 5%, 96%); /* 過去のバスの背景色 */
        }

        .bus-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .bus-item-route {
            font-size: 1rem; /* さらに小さく */
            font-weight: 600;
            color: hsl(240, 10%, 30%);
            width: 40%;
            text-align: left;
        }

        .bus-item-time {
            font-size: 1.4rem; /* さらに小さく */
            font-weight: 700;
            color: hsl(210, 80%, 45%); /* 深みのあるアクセントブルー */
            width: 60%;
            text-align: right;
        }

        .arrival-time-display, .destination-display {
            font-size: 0.85rem; /* さらに小さく */
            color: hsl(240, 5%, 55%); /* 落ち着いたグレー */
            font-weight: 400;
            margin-top: 6px; /* マージン調整 */
            padding-top: 6px; /* パディング調整 */
            border-top: 1px dashed hsl(240, 5%, 85%); /* 薄い点線 */
            width: 100%;
            text-align: left;
            box-sizing: border-box;
        }
        
        .arrival-time-display {
            height: 0;
            overflow: hidden;
            transition: all 0.3s ease-out;
        }
        .arrival-time-display.visible {
            height: auto;
            padding-top: 8px;
            margin-top: 8px;
        }
        .arrival-time-display.hidden {
            padding-top: 0;
            margin-top: 0;
        }

        /* スクロールバーのスタイル */
        .bus-list::-webkit-scrollbar {
            width: 6px; /* スクロールバーを細く */
        }
        .bus-list::-webkit-scrollbar-track {
            background: hsl(240, 10%, 97%); /* 背景色に合わせる */
            border-radius: 10px;
        }
        .bus-list::-webkit-scrollbar-thumb {
            background: hsl(240, 5%, 80%); /* 少し明るいグレー */
            border-radius: 10px;
        }
        .bus-list::-webkit-scrollbar-thumb:hover {
            background: hsl(240, 5%, 65%); /* ホバーで少し濃く */
        }

        /* レスポンシブ調整 */
        @media (max-width: 640px) {
            body {
                padding: 5px;
            }
            .container {
                padding: 15px;
                border-radius: 12px;
                height: 98vh;
            }
            h1 {
                font-size: 1.6rem; /* モバイルでさらに小さく */
                margin-bottom: 8px;
            }
            .instruction-text {
                font-size: 0.75rem; /* モバイルでさらに小さく */
                margin-bottom: 10px;
            }
            .selector-group {
                gap: 8px;
                margin-bottom: 10px;
            }
            /* モバイルでも平日/土日祝ボタンは横並びを維持し、さらにコンパクトに */
            .schedule-selector {
                flex-direction: row; /* 横並びを維持 */
                gap: 13px; /* ボタン間の間隔をさらに詰める */
                max-width: 180px; /* 全体として横幅を縮める */
            }
            .schedule-selector label {
                font-size: 0.7rem; /* さらに小さく */
                padding: 4px 6px; /* パディングを最小限まで小さく */
                flex-basis: auto; /* コンテンツに合わせて幅を調整 */
                flex-grow: 0; /* 伸びを無効にする */
            }

            .bus-stop-selector {
                max-width: 160px; /* モバイルでも縦幅を維持しつつ調整 */
            }
            .bus-stop-selector label {
                font-size: 0.75rem; /* モバイルでさらに小さく */
                padding: 5px 8px; /* モバイルでさらにパディングを減らす */
            }
            .hour-title {
                font-size: 1.2rem;
            }
            .bus-item {
                padding: 8px 10px;
                border-radius: 6px;
            }
            .bus-item-route {
                font-size: 0.9rem;
            }
            .bus-item-time {
                font-size: 1.2rem;
            }
            .arrival-time-display, .destination-display {
                font-size: 0.75rem;
                margin-top: 5px;
                padding-top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>バス時刻表</h1>
        <div class="instruction-text">春日台6丁目発のバス項目をタップ（クリック）すると、終点・西神中央駅前への到着時刻が表示されます。</div>

        <div class="selector-group">
            <div class="schedule-selector">
                <label>
                    <input type="radio" name="scheduleType" value="weekday" id="weekdayRadio"> 　⠀平日　⠀
                </label>
                <label>
                    <input type="radio" name="scheduleType" value="holiday" id="holidayRadio"> 　土日祝　
                </label>
            </div>
            <div class="bus-stop-selector">
                <label>
                    <input type="radio" name="busStop" value="kasugadai6chome" id="kasugadai6chomeRadio"> 春日台6丁目発
                </label>
                <label>
                    <input type="radio" name="busStop" value="seishinchuoekimae" id="seishinChuoEkiMaeRadio"> 西神中央駅前発
                </label>
            </div>
        </div>

        <div id="bus-schedule" class="bus-list">
            </div>
    </div>
        
    <script>
        // Bus timetable data (route number and time) - departing from Kasugadai 6-chome
        const weekdayKasugadaiBusData = [
            { route: '21', time: '5:54' }, { route: '22', time: '6:06' }, { route: '21', time: '6:23' },
            { route: '28', time: '6:34' }, { route: '28', time: '6:44' }, { route: '28', time: '6:54' },
            { route: '22', time: '7:02' }, { route: '21', time: '7:09' }, { route: '28', time: '7:17' },
            { route: '21', time: '7:21' }, { route: '22', time: '7:26' }, { route: '21', time: '7:33' },
            { route: '21', time: '7:45' }, { route: '28', time: '7:51' }, { route: '28', time: '7:59' },
            { route: '21', time: '8:05' }, { route: '28', time: '8:14' }, { route: '22', time: '8:19' },
            { route: '28', time: '8:29' }, { route: '22', time: '8:31' }, { route: '28', time: '8:44' },
            { route: '28', time: '9:00' }, { route: '22', time: '9:08' }, { route: '21', time: '9:23' },
            { route: '28', time: '9:40' }, { route: '22', time: '10:08' }, { route: '21', time: '10:23' },
            { route: '28', time: '10:40' }, { route: '22', time: '11:08' }, { route: '21', time: '11:23' },
            { route: '28', time: '11:40' }, { route: '22', time: '12:08' }, { route: '21', time: '12:23' },
            { route: '28', time: '12:40' }, { route: '21', time: '13:02' }, { route: '22', time: '13:08' },
            { route: '21', time: '13:23' }, { route: '28', time: '13:40' }, { route: '22', time: '14:08' },
            { route: '21', time: '14:23' }, { route: '28', time: '14:40' }, { route: '21', time: '14:53' },
            { route: '22', time: '15:08' }, { route: '21', time: '15:23' }, { route: '28', time: '15:40' },
            { route: '22', time: '15:48' }, { route: '28', time: '15:55' }, { route: '21', time: '16:02' },
            { route: '22', time: '16:07' }, { route: '28', time: '16:15' }, { route: '22', time: '16:22' },
            { route: '28', time: '16:30' }, { route: '22', time: '16:37' }, { route: '21', time: '16:42' },
            { route: '22', time: '16:52' }, { route: '28', time: '17:00' }, { route: '22', time: '17:07' },
            { route: '28', time: '17:15' }, { route: '22', time: '17:22' }, { route: '28', time: '17:30' },
            { route: '21', time: '17:37' }, { route: '28', time: '17:45' }, { route: '28', time: '18:00' },
            { route: '22', time: '18:10' }, { route: '21', time: '18:17' }, { route: '22', time: '18:40' },
            { route: '28', time: '18:57' }, { route: '21', time: '19:07' }, { route: '28', time: '19:17' },
            { route: '22', time: '19:43' }, { route: '28', time: '19:48' }, { route: '22', time: '20:01' },
            { route: '28', time: '20:13' }, { route: '21', time: '21:18' }, { route: '28', time: '21:54' }
        ];
        const holidayKasugadaiBusData = [
            { route: '21', time: '5:56' }, { route: '21', time: '6:15' }, { route: '28', time: '6:30' },
            { route: '28', time: '6:45' }, { route: '22', time: '7:08' }, { route: '21', time: '7:23' },
            { route: '22', time: '7:38' }, { route: '21', time: '7:48' }, { route: '22', time: '7:53' },
            { route: '22', time: '8:08' }, { route: '21', time: '8:14' }, { route: '22', time: '8:23' },
            { route: '22', time: '8:38' }, { route: '22', time: '8:53' }, { route: '22', time: '9:08' },
            { route: '21', time: '9:23' }, { route: '28', time: '9:40' }, { route: '22', time: '10:08' },
            { route: '21', time: '10:23' }, { route: '28', time: '10:40' }, { route: '22', time: '11:08' },
            { route: '21', time: '11:23' }, { route: '28', time: '11:40' }, { route: '22', time: '12:08' },
            { route: '21', time: '12:23' }, { route: '28', time: '12:40' }, { route: '21', time: '13:02' },
            { route: '22', time: '13:08' }, { route: '21', time: '13:23' }, { route: '28', time: '13:40' },
            { route: '22', time: '14:08' }, { route: '21', time: '14:23' }, { route: '28', time: '14:40' },
            { route: '22', time: '15:08' }, { route: '21', time: '15:23' }, { route: '28', time: '15:40' },
            { route: '21', time: '16:11' }, { route: '21', time: '16:41' }, { route: '22', time: '17:11' },
            { route: '22', time: '17:41' }, { route: '22', time: '18:11' }, { route: '22', time: '18:41' },
            { route: '22', time: '19:11' }, { route: '22', time: '19:41' }, { route: '28', time: '21:07' },
            { route: '22', time: '22:21' }
        ];
        // バス時刻データ (系統番号、時刻、行き先コード) - 西神中央駅前発
        const weekdaySeishinChuoBusData = [
            { route: '22', time: '6:12', destinationCode: 'a' },
            { route: '28', time: '6:32', destinationCode: 'b' },
            { route: '28', time: '6:42', destinationCode: 'b' },
            { route: '22', time: '6:44', destinationCode: 'a' },
            { route: '22', time: '7:04', destinationCode: 'a' },
            { route: '28', time: '7:11', destinationCode: 'a' },
            { route: '21', time: '7:23', destinationCode: 'a' },
            { route: '22', time: '7:27', destinationCode: 'a' },
            { route: '28', time: '7:38', destinationCode: 'a' },
            { route: '22', time: '7:43', destinationCode: 'a' },
            { route: '28', time: '7:50', destinationCode: 'a' },
            { route: '22', time: '7:55', destinationCode: 'a' },
            { route: '28', time: '8:05', destinationCode: 'a' },
            { route: '22', time: '8:07', destinationCode: 'a' },
            { route: '21', time: '8:20', destinationCode: 'a' },
            { route: '28', time: '8:33', destinationCode: 'a' },
            { route: '22', time: '8:35', destinationCode: 'a' },
            { route: '28', time: '8:45', destinationCode: 'a' },
            { route: '22', time: '8:46', destinationCode: 'a' },
            { route: '28', time: '9:00', destinationCode: 'a' },
            { route: '22', time: '9:10', destinationCode: 'b' },
            { route: '28', time: '9:20', destinationCode: 'b' },
            { route: '22', time: '9:30', destinationCode: 'a' },
            { route: '28', time: '9:40', destinationCode: 'b' },
            { route: '21', time: '9:45', destinationCode: 'a' },
            { route: '22', time: '9:50', destinationCode: 'b' },
            { route: '28', time: '10:00', destinationCode: 'a' },
            { route: '22', time: '10:10', destinationCode: 'b' },
            { route: '28', time: '10:20', destinationCode: 'b' },
            { route: '22', time: '10:30', destinationCode: 'a' },
            { route: '28', time: '10:40', destinationCode: 'b' },
            { route: '21', time: '10:45', destinationCode: 'a' },
            { route: '22', time: '10:50', destinationCode: 'b' },
            { route: '28', time: '11:00', destinationCode: 'a' },
            { route: '22', time: '11:10', destinationCode: 'b' },
            { route: '28', time: '11:20', destinationCode: 'b' },
            { route: '22', time: '11:30', destinationCode: 'a' },
            { route: '28', time: '11:40', destinationCode: 'b' },
            { route: '21', time: '11:45', destinationCode: 'a' },
            { route: '22', time: '11:50', destinationCode: 'b' },
            { route: '28', time: '12:00', destinationCode: 'a' },
            { route: '22', time: '12:10', destinationCode: 'b' },
            { route: '28', time: '12:20', destinationCode: 'b' },
            { route: '22', time: '12:30', destinationCode: 'a' },
            { route: '28', time: '12:40', destinationCode: 'b' },
            { route: '21', time: '12:45', destinationCode: 'a' },
            { route: '22', time: '12:50', destinationCode: 'b' },
            { route: '28', time: '13:00', destinationCode: 'a' },
            { route: '22', time: '13:10', destinationCode: 'b' },
            { route: '21', time: '13:20', destinationCode: 'a' },
            { route: '28', time: '13:20', destinationCode: 'b' },
            { route: '22', time: '13:30', destinationCode: 'a' },
            { route: '28', time: '13:40', destinationCode: 'b' },
            { route: '21', time: '13:45', destinationCode: 'a' },
            { route: '22', time: '13:50', destinationCode: 'b' },
            { route: '28', time: '14:00', destinationCode: 'a' },
            { route: '22', time: '14:10', destinationCode: 'b' },
            { route: '21', time: '14:20', destinationCode: 'a' },
            { route: '28', time: '14:20', destinationCode: 'b' },
            { route: '22', time: '14:30', destinationCode: 'a' },
            { route: '28', time: '14:40', destinationCode: 'b' },
            { route: '21', time: '14:45', destinationCode: 'a' },
            { route: '22', time: '14:50', destinationCode: 'b' },
            { route: '28', time: '15:00', destinationCode: 'a' },
            { route: '22', time: '15:10', destinationCode: 'b' },
            { route: '21', time: '15:20', destinationCode: 'a' },
            { route: '28', time: '15:20', destinationCode: 'b' },
            { route: '22', time: '15:30', destinationCode: 'a' },
            { route: '28', time: '15:40', destinationCode: 'a' },
            { route: '21', time: '15:45', destinationCode: 'a' },
            { route: '22', time: '15:50', destinationCode: 'a' },
            { route: '28', time: '16:00', destinationCode: 'b' },
            { route: '22', time: '16:05', destinationCode: 'a' },
            { route: '28', time: '16:15', destinationCode: 'a' },
            { route: '22', time: '16:20', destinationCode: 'a' },
            { route: '28', time: '16:30', destinationCode: 'a' },
            { route: '22', time: '16:35', destinationCode: 'b' },
            { route: '21', time: '16:40', destinationCode: 'a' },
            { route: '28', time: '16:45', destinationCode: 'a' },
            { route: '22', time: '16:50', destinationCode: 'c' },
            { route: '21', time: '16:55', destinationCode: 'a' },
            { route: '28', time: '17:00', destinationCode: 'a' },
            { route: '22', time: '17:05', destinationCode: 'a' },
            { route: '28', time: '17:15', destinationCode: 'a' },
            { route: '22', time: '17:20', destinationCode: 'a' },
            { route: '28', time: '17:30', destinationCode: 'b' },
            { route: '22', time: '17:35', destinationCode: 'a' },
            { route: '28', time: '17:45', destinationCode: 'b' },
            { route: '21', time: '17:50', destinationCode: 'a' },
            { route: '22', time: '17:52', destinationCode: 'a' },
            { route: '28', time: '18:00', destinationCode: 'a' },
            { route: '22', time: '18:02', destinationCode: 'b' },
            { route: '28', time: '18:12', destinationCode: 'b' },
            { route: '22', time: '18:14', destinationCode: 'a' },
            { route: '28', time: '18:24', destinationCode: 'd' },
            { route: '22', time: '18:24', destinationCode: 'b' },
            { route: '22', time: '18:34', destinationCode: 'a' },
            { route: '28', time: '18:36', destinationCode: 'd' },
            { route: '21', time: '18:40', destinationCode: 'a' },
            { route: '22', time: '18:44', destinationCode: 'a' },
            { route: '28', time: '18:48', destinationCode: 'b' },
            { route: '22', time: '18:54', destinationCode: 'a' },
            { route: '28', time: '19:00', destinationCode: 'b' },
            { route: '22', time: '19:05', destinationCode: 'a' },
            { route: '28', time: '19:12', destinationCode: 'b' },
            { route: '22', time: '19:20', destinationCode: 'a' },
            { route: '28', time: '19:24', destinationCode: 'd' },
            { route: '21', time: '19:28', destinationCode: 'a' },
            { route: '22', time: '19:38', destinationCode: 'c' },
            { route: '28', time: '19:38', destinationCode: 'a' },
            { route: '22', time: '19:51', destinationCode: 'c' },
            { route: '28', time: '19:51', destinationCode: 'a' },
            { route: '22', time: '20:03', destinationCode: 'c' },
            { route: '28', time: '20:07', destinationCode: 'b' },
            { route: '21', time: '20:20', destinationCode: 'a' },
            { route: '28', time: '20:20', destinationCode: 'd' },
            { route: '22', time: '20:22', destinationCode: 'b' },
            { route: '28', time: '20:33', destinationCode: 'b' },
            { route: '22', time: '20:38', destinationCode: 'a' },
            { route: '28', time: '20:47', destinationCode: 'b' },
            { route: '22', time: '20:55', destinationCode: 'a' },
            { route: '28', time: '21:03', destinationCode: 'd' },
            { route: '22', time: '21:13', destinationCode: 'b' },
            { route: '28', time: '21:25', destinationCode: 'b' },
            { route: '21', time: '21:33', destinationCode: 'a' },
            { route: '22', time: '21:35', destinationCode: 'c' },
            { route: '28', time: '21:46', destinationCode: 'b' },
            { route: '22', time: '21:59', destinationCode: 'a' },
            { route: '28', time: '22:05', destinationCode: 'b' },
            { route: '22', time: '22:16', destinationCode: 'a' },
            { route: '28', time: '22:23', destinationCode: 'a' },
            { route: '22', time: '22:36', destinationCode: 'b' },
            { route: '28', time: '22:45', destinationCode: 'b' },
            { route: '22', time: '22:50', destinationCode: 'a' },
            { route: '28', time: '22:58', destinationCode: 'a' },
            { route: '22', time: '23:05', destinationCode: 'c' },
            { route: '22', time: '23:21', destinationCode: 'c' },
            { route: '28', time: '23:21', destinationCode: 'd' }
        ];
        // バス時刻データ (系統番号、時刻、行き先コード) - 西神中央駅前発 土日祝
        const holidaySeishinChuoBusData = [
            { route: '28', time: '6:48', destinationCode: 'a' },
            { route: '28', time: '7:03', destinationCode: 'a' },
            { route: '28', time: '7:18', destinationCode: 'a' },
            { route: '22', time: '7:27', destinationCode: 'a' },
            { route: '21', time: '7:33', destinationCode: 'a' },
            { route: '28', time: '7:45', destinationCode: 'a' },
            { route: '22', time: '7:52', destinationCode: 'a' },
            { route: '28', time: '8:03', destinationCode: 'a' },
            { route: '28', time: '8:18', destinationCode: 'a' },
            { route: '22', time: '8:20', destinationCode: 'b' },
            { route: '21', time: '8:31', destinationCode: 'a' },
            { route: '22', time: '8:35', destinationCode: 'b' },
            { route: '28', time: '8:45', destinationCode: 'a' },
            { route: '22', time: '8:50', destinationCode: 'b' },
            { route: '28', time: '9:00', destinationCode: 'a' },
            { route: '22', time: '9:10', destinationCode: 'b' },
            { route: '28', time: '9:20', destinationCode: 'b' },
            { route: '22', time: '9:30', destinationCode: 'a' },
            { route: '28', time: '9:40', destinationCode: 'b' },
            { route: '21', time: '9:45', destinationCode: 'a' },
            { route: '22', time: '9:50', destinationCode: 'b' },
            { route: '28', time: '10:00', destinationCode: 'a' },
            { route: '22', time: '10:10', destinationCode: 'b' },
            { route: '28', time: '10:20', destinationCode: 'b' },
            { route: '22', time: '10:30', destinationCode: 'a' },
            { route: '28', time: '10:40', destinationCode: 'b' },
            { route: '21', time: '10:45', destinationCode: 'a' },
            { route: '22', time: '10:50', destinationCode: 'b' },
            { route: '28', time: '11:00', destinationCode: 'a' },
            { route: '22', time: '11:10', destinationCode: 'b' },
            { route: '28', time: '11:20', destinationCode: 'b' },
            { route: '22', time: '11:30', destinationCode: 'a' },
            { route: '28', time: '11:40', destinationCode: 'b' },
            { route: '21', time: '11:45', destinationCode: 'a' },
            { route: '22', time: '11:50', destinationCode: 'b' },
            { route: '28', time: '12:00', destinationCode: 'a' },
            { route: '22', time: '12:10', destinationCode: 'b' },
            { route: '21', time: '12:20', destinationCode: 'a' },
            { route: '28', time: '12:20', destinationCode: 'b' },
            { route: '22', time: '12:30', destinationCode: 'a' },
            { route: '28', time: '12:40', destinationCode: 'b' },
            { route: '21', time: '12:45', destinationCode: 'a' },
            { route: '22', time: '12:50', destinationCode: 'b' },
            { route: '28', time: '13:00', destinationCode: 'a' },
            { route: '22', time: '13:10', destinationCode: 'b' },
            { route: '28', time: '13:20', destinationCode: 'b' },
            { route: '22', time: '13:30', destinationCode: 'a' },
            { route: '28', time: '13:40', destinationCode: 'b' },
            { route: '21', time: '13:45', destinationCode: 'a' },
            { route: '22', time: '13:50', destinationCode: 'b' },
            { route: '28', time: '14:00', destinationCode: 'a' },
            { route: '22', time: '14:10', destinationCode: 'b' },
            { route: '21', time: '14:20', destinationCode: 'a' },
            { route: '28', time: '14:20', destinationCode: 'b' },
            { route: '22', time: '14:30', destinationCode: 'a' },
            { route: '28', time: '14:40', destinationCode: 'b' },
            { route: '21', time: '14:45', destinationCode: 'a' },
            { route: '22', time: '14:50', destinationCode: 'b' },
            { route: '28', time: '15:00', destinationCode: 'a' },
            { route: '22', time: '15:10', destinationCode: 'b' },
            { route: '21', time: '15:20', destinationCode: 'a' },
            { route: '28', time: '15:20', destinationCode: 'b' },
            { route: '22', time: '15:30', destinationCode: 'a' },
            { route: '28', time: '15:40', destinationCode: 'b' },
            { route: '22', time: '15:50', destinationCode: 'b' },
            { route: '21', time: '15:52', destinationCode: 'a' },
            { route: '28', time: '16:00', destinationCode: 'b' },
            { route: '22', time: '16:10', destinationCode: 'b' },
            { route: '21', time: '16:20', destinationCode: 'a' },
            { route: '28', time: '16:20', destinationCode: 'b' },
            { route: '22', time: '16:30', destinationCode: 'b' },
            { route: '28', time: '16:40', destinationCode: 'b' },
            { route: '22', time: '16:50', destinationCode: 'b' },
            { route: '21', time: '16:52', destinationCode: 'a' },
            { route: '28', time: '17:00', destinationCode: 'd' },
            { route: '22', time: '17:10', destinationCode: 'b' },
            { route: '28', time: '17:20', destinationCode: 'a' },
            { route: '22', time: '17:25', destinationCode: 'c' },
            { route: '22', time: '17:40', destinationCode: 'b' },
            { route: '28', time: '17:40', destinationCode: 'a' },
            { route: '21', time: '17:52', destinationCode: 'a' },
            { route: '22', time: '17:55', destinationCode: 'c' },
            { route: '28', time: '18:00', destinationCode: 'd' },
            { route: '22', time: '18:10', destinationCode: 'b' },
            { route: '28', time: '18:20', destinationCode: 'a' },
            { route: '22', time: '18:25', destinationCode: 'c' },
            { route: '22', time: '18:40', destinationCode: 'b' },
            { route: '28', time: '18:40', destinationCode: 'd' },
            { route: '21', time: '18:52', destinationCode: 'a' },
            { route: '22', time: '18:55', destinationCode: 'c' },
            { route: '28', time: '19:00', destinationCode: 'd' },
            { route: '22', time: '19:10', destinationCode: 'b' },
            { route: '28', time: '19:20', destinationCode: 'a' },
            { route: '22', time: '19:30', destinationCode: 'c' },
            { route: '28', time: '19:40', destinationCode: 'a' },
            { route: '22', time: '19:50', destinationCode: 'b' },
            { route: '28', time: '20:00', destinationCode: 'b' },
            { route: '22', time: '20:10', destinationCode: 'a' },
            { route: '28', time: '20:20', destinationCode: 'a' },
            { route: '22', time: '20:30', destinationCode: 'b' },
            { route: '28', time: '20:40', destinationCode: 'b' },
            { route: '21', time: '20:45', destinationCode: 'a' },
            { route: '22', time: '20:50', destinationCode: 'c' },
            { route: '28', time: '21:00', destinationCode: 'd' },
            { route: '22', time: '21:10', destinationCode: 'c' },
            { route: '28', time: '21:20', destinationCode: 'b' },
            { route: '21', time: '21:25', destinationCode: 'a' },
            { route: '22', time: '21:30', destinationCode: 'b' },
            { route: '28', time: '21:45', destinationCode: 'd' },
            { route: '22', time: '21:50', destinationCode: 'c' },
            { route: '28', time: '22:00', destinationCode: 'a' },
            { route: '22', time: '22:10', destinationCode: 'b' },
            { route: '28', time: '22:10', destinationCode: 'd' },
            { route: '22', time: '22:40', destinationCode: 'c' },
            { route: '28', time: '22:40', destinationCode: 'd' }
        ];

        let currentActiveSchedule = null; /* Current selected timetable type (weekday/holiday) */
        let currentBusStopType = null; /* Current selected bus stop type (kasugadai6chome/seishinchuoekimae) */

        /**
         * Function to convert destination code to text
         * @param {string} code - Destination code (a, b, c, d)
         * @returns {string} - Japanese text of the destination
         */
        function getDestinationText(code) {
            switch (code) {
                case 'a': return '西体育館行';
                case 'b': return '循環　西神中央駅前行';
                case 'c': return 'かすがプラザ止';
                case 'd': return '春日台4丁目止';
                default: return '';
            }
        }

        /**
         * Function to calculate arrival time
         * @param {string} departureTimeStr - Departure time (e.g., "7:09")
         * @param {string} route - Route number (e.g., "21")
         * @param {string} scheduleType - Schedule type ("weekday" or "holiday")
         * @returns {string} - Arrival time (HH:MM format)
         */
        function calculateArrivalTime(departureTimeStr, route, scheduleType) {
            const [depHour, depMinute] = departureTimeStr.split(':').map(Number);
            let travelMinutes;

            if (scheduleType === 'weekday') {
                // Weekdays: travel time changes at 9 AM
                if (depHour < 9) { // Departures before 9:00 AM
                    if (route === '21') travelMinutes = 13;
                    else if (route === '22') travelMinutes = 17;
                    else if (route === '28') travelMinutes = 16;
                } else { // Departures after 9:00 AM
                    if (route === '21') travelMinutes = 13;
                    else if (route === '22') travelMinutes = 14;
                    else if (route === '28') travelMinutes = 13;
                }
            } else { // Weekends and holidays
                if (route === '21') travelMinutes = 12;
                else if (route === '22') travelMinutes = 14;
                else if (route === '28') travelMinutes = 13;
            }

            let arrivalTotalMinutes = (depHour * 60 + depMinute) + travelMinutes;
            let arrHour = Math.floor(arrivalTotalMinutes / 60);
            let arrMinute = arrivalTotalMinutes % 60;
            // Adjust time if it crosses midnight (not expected for bus operating hours, but just in case)
            if (arrHour >= 24) arrHour -= 24;
            return `${arrHour.toString().padStart(2, '0')}:${arrMinute.toString().padStart(2, '0')}`;
        }

        /**
         * Helper function to get the currently selected bus data (weekday/holiday, by bus stop)
         * @returns {Array<Object>} Selected bus data
         */
        function getSelectedBusData() {
            if (currentBusStopType === 'kasugadai6chome') {
                return currentActiveSchedule === 'weekday' ?
                weekdayKasugadaiBusData : holidayKasugadaiBusData;
            } else { // currentBusStopType === 'seishinchuoekimae'
                return currentActiveSchedule === 'weekday' ?
                weekdaySeishinChuoBusData : holidaySeishinChuoBusData;
            }
        }

        /**
         * Function to generate/update the timetable based on the given time data
         * @param {Array<Object>} currentBusData - Bus data to display
         * @param {string} busStopType - Type of bus stop currently displayed ('kasugadai6chome' or 'seishinchuoekimae')
         */
        function generateTimetable(currentBusData, busStopType) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();

            const scheduleContainer = document.getElementById('bus-schedule');
            scheduleContainer.innerHTML = ''; /* Clear existing content */

            const groupedBusData = {};
            currentBusData.forEach(bus => {
                const hour = parseInt(bus.time.split(':')[0]);
                if (!groupedBusData[hour]) {
                    groupedBusData[hour] = [];
                }
                groupedBusData[hour].push(bus);
            });

            let firstUpcomingBusElement = null;

            const sortedHours = Object.keys(groupedBusData).sort((a, b) => Number(a) - Number(b));
            sortedHours.forEach(hour => {
                const hourGroupDiv = document.createElement('div');
                hourGroupDiv.classList.add('hour-group');
                hourGroupDiv.id = `hour-group-${hour}`;

                const hourTitle = document.createElement('h2');
                hourTitle.classList.add('hour-title');
                hourTitle.textContent = `${hour}時`;
                hourGroupDiv.appendChild(hourTitle);

                groupedBusData[hour].forEach(bus => {
                    const [busHour, busMinute] = bus.time.split(':').map(Number);
                    const busTimeInMinutes = busHour * 60 + busMinute;
                    const currentTimeInMinutes = currentHour * 60 + currentMinute;

                    const busItem = document.createElement('div');
                    busItem.classList.add('bus-item');

                    if (busTimeInMinutes > currentTimeInMinutes && firstUpcomingBusElement === null) {
                        busItem.classList.add('upcoming');
                        firstUpcomingBusElement = busItem;
                    } else if (busTimeInMinutes <= currentTimeInMinutes) {
                        busItem.classList.add('past');
                    }

                    const busInfoDiv = document.createElement('div');
                    busInfoDiv.classList.add('bus-info');

                    const routeSpan = document.createElement('span');
                    routeSpan.classList.add('bus-item-route');
                    routeSpan.textContent = `${bus.route}系統`;

                    const timeSpan = document.createElement('span');
                    timeSpan.classList.add('bus-item-time');
                    timeSpan.textContent = bus.time;

                    busInfoDiv.appendChild(routeSpan);
                    busInfoDiv.appendChild(timeSpan);
                    busItem.appendChild(busInfoDiv);
                    // Branch display content and click events depending on bus stop type
                    if (busStopType === 'kasugadai6chome') {
                        busItem.classList.add('clickable');
                        // For buses departing from Kasugadai 6-chome, always add "for Seishin-Chuo Station"
                        const destinationDisplay = document.createElement('div');
                        destinationDisplay.classList.add('destination-display');
                        destinationDisplay.textContent = '西神中央駅前行';
                        busItem.appendChild(destinationDisplay);
                        const arrivalTimeDisplay = document.createElement('div');
                        arrivalTimeDisplay.classList.add('arrival-time-display', 'hidden');
                        busItem.appendChild(arrivalTimeDisplay);

                        busItem.addEventListener('click', () => {
                            const arrivalTime = calculateArrivalTime(bus.time, bus.route, currentActiveSchedule);
                            arrivalTimeDisplay.textContent = `西神中央駅前 到着時刻: ${arrivalTime}`;
                            arrivalTimeDisplay.classList.toggle('visible');
                            arrivalTimeDisplay.classList.toggle('hidden');
                        });
                    } else if (busStopType === 'seishinchuoekimae') {
                        const destinationDisplay = document.createElement('div');
                        destinationDisplay.classList.add('destination-display');
                        destinationDisplay.textContent = getDestinationText(bus.destinationCode);
                        busItem.appendChild(destinationDisplay);
                        // For buses departing from Seishin-Chuo Station, there is no click action, so the cursor is default
                        busItem.style.cursor = 'default';
                    }

                    hourGroupDiv.appendChild(busItem);
                });

                scheduleContainer.appendChild(hourGroupDiv);
            });

            // Scroll to the first upcoming bus if found
            if (firstUpcomingBusElement) {
                setTimeout(() => {
                    firstUpcomingBusElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            } else if (currentBusData.length > 0) {
                // If no upcoming buses (e.g., after the last bus of the day)
                const noUpcoming = document.createElement('div');
                noUpcoming.classList.add('bus-item', 'text-gray-600', 'justify-center');
                noUpcoming.textContent = '本日の運行は終了しました。';
                scheduleContainer.appendChild(noUpcoming);
            } else {
                 // If there is no bus data at all
                const noData = document.createElement('div');
                noData.classList.add('bus-item', 'text-gray-600', 'justify-center');
                noData.textContent = '表示するバスデータがありません。';
                scheduleContainer.appendChild(noData);
            }
        }

        // Initial loading process
        window.onload = function() {
            // Get radio button elements
            const weekdayRadio = document.getElementById('weekdayRadio');
            const holidayRadio = document.getElementById('holidayRadio');
            const kasugadai6chomeRadio = document.getElementById('kasugadai6chomeRadio');
            const seishinChuoEkiMaeRadio = document.getElementById('seishinChuoEkiMaeRadio');
            // Determine the current day of the week and select the default timetable type
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0: Sunday, 1: Monday, ..., 6: Saturday

            if (dayOfWeek === 0 || dayOfWeek === 6) { // Sunday or Saturday
                holidayRadio.checked = true;
                currentActiveSchedule = 'holiday';
            } else { // Weekday
                weekdayRadio.checked = true;
                currentActiveSchedule = 'weekday';
            }

            // Default bus stop selection (Seishin-Chuo Station as default)
            seishinChuoEkiMaeRadio.checked = true;
            currentBusStopType = 'seishinchuoekimae';

            // Generate initial timetable
            generateTimetable(getSelectedBusData(), currentBusStopType);
            // Set up change event listeners for radio buttons
            weekdayRadio.addEventListener('change', () => {
                if (weekdayRadio.checked) {
                    currentActiveSchedule = 'weekday';
                    generateTimetable(getSelectedBusData(), currentBusStopType);
                }
            });

            holidayRadio.addEventListener('change', () => {
                if (holidayRadio.checked) {
                    currentActiveSchedule = 'holiday';
                    generateTimetable(getSelectedBusData(), currentBusStopType);
                }
            });
            kasugadai6chomeRadio.addEventListener('change', () => {
                if (kasugadai6chomeRadio.checked) {
                    currentBusStopType = 'kasugadai6chome';
                    generateTimetable(getSelectedBusData(), currentBusStopType);
                }
            });
            seishinChuoEkiMaeRadio.addEventListener('change', () => {
                if (seishinChuoEkiMaeRadio.checked) {
                    currentBusStopType = 'seishinchuoekimae';
                    generateTimetable(getSelectedBusData(), currentBusStopType);
                }
            });
            // Update timetable every minute
            setInterval(() => {
                generateTimetable(getSelectedBusData(), currentBusStopType);
            }, 60 * 1000);
        };
    
        // Service worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>
